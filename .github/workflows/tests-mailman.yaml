name: Run tests (GNU Mailman 3)

on:
  # # Trigger the workflow on master but also allow it to run manually.
  # workflow_dispatch:
  # push:
  #    branches:
  #      - master
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - master

jobs:
  run_tox:
    name: tox -e falcon
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
        with:
          fetch-depth: 2

      - name: Fetch Mailman Core
        run: |
          tools/testing/fetch_mailman.sh

      - name: Run tox
        uses: docker://ghcr.io/maxking/mailman-ci-runner-falcon:master
        with:
          args: |
            /bin/bash -c "
            python -m pip install -U pip tox &&
            python --version &&
            pip --version &&
            tox --version &&
            tox -c .ecosystem/mailman/tox.ini -e falcon-nocov"
